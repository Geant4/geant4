
\section{HETC model overview} % jaottelu oli Intro, HETC model, Algorithms

\subsection{Background}


%HETC simulates the hadronic cascade by using Monte
%Carlo techniques to to solve the Boltzman
%transport equation and to compute the trajectories of the primary particle
%( p, n, Pi<sup><u>+</u></sup>, and Mu<sup><u>+</u></sup> )   and the secondary particles produced in nuclear collisions. 
%Each particle is followed until it eventually escapes from the
%    geometric boundaries of the system, undergoes nuclear collision or
%    absorption, comes to rest due to energy losses from ionization and
%    excitation of atomic electrons, or decays. 
%
%<p>Although originally developed in 1972, HETC has continued to undergo
%    improvement and has been recently extended to treat the very high
%    energies of the Large Hadron Collider (LHC) project. 
%Presently, HETC performs the particle transport and generation in a
 %   three-fold manner: 
%<ol>
%<li>for energies less than 3 GeV, particles are
%    generated by means of an intermediate-energy Intranuclear Cascade
%    and Evaporation Model,
%<li>from 3 GeV to approximately 10 GeV,
%    particle generation is done by means of a scaling model, and
%<li>
%    above 10 GeV, particle generation is done by means of a multi-chain fragmentation model.
%</ol>%
%
%<p>HETC has been benchmarked against numerous accelerator-based and spaced-based experiments with excellent
%success. It has also been adopted by a number of other organizations and tailored to their requirements. 
%</p>
%<h3>Latest development</h3>
%<p>Latest development in HETC is it's implementation as HETC++ into
%    Geant4. 
%HETC++ is completely rewritten using object oriented methods and c++ language. 
%Code is capsulated into classes according to Geant4 hadronic physics
%processes interface.


HETC \footnote{Full name in the original 70's manual read as 'Monte Carlo High-Energy Nucleon-Meson Transport Code System'} is a Monte Carlo transport code for computing the properties of high-energy nucleon-meson cascades in matter.
%HETC simulates the hadronic cascade by using Monte Carlo techniques
%to solve the Boltzman transport equation and to compute the
It computes the trajectories of the primary particle ($p$, $n$,
$\pi^{\pm}$, or $\mu^{\pm}$) and the secondary particles produced in
nuclear collisions. Each particle is followed until it eventually
escapes from the geometric boundaries of the system, undergoes nuclear
collision or absorption, comes to rest due to energy losses from
ionization and excitation of atomic electrons or decays. HETC cannot
handle the low-energy neutron transport or electromagnetic
interactions, which must be handled with other models.

% HETC simulates the hadronic cascade
% by using Monte Carlo techniques to compute the trajectories of the
% primary particle and the secondary particles produced in nuclear
% collisions. It was developed on the basis of the existing
% Nucleon-Meson Transport Code (NMTC) and the incorporated code for the
% neutron transport. The evolution of HETC code is presented in
% Table~\ref{taul:hetcHistory}.~\cite{bertini63,ornlhetc}

HETC was originally developed 
%by researchers in the Nuclear Analysis
%and Shielding Section of 
in Oak Ridge National Laboratory (ORNL), Oak Ridge, Tennessee.
%Computational Physics and Engineering Division 
in 1972 using FORTRAN IV nad IBM 360/370.  
Basically HETC was written as extension to NMTC code.


Major parts of the original Bertini INC code are still present, 
making the code extremely difficult to read. 
Until nowadays, HETC has undergone several improvements and
has been recently extended to treat the very high energies of the LHC.
Usually the improvements have been related to the update of
experimental cross-sections or to revision of specific collision
models such as the multi-chain fragmentation model~\cite{alsmiller90}.
HETC has been developed by many different groups, but unfortunately
with no coordination.  As a result, many different versions of the
code exists.  The basic ideas of HETC have, however, not changed. \cite{bertini68}

HETC has been included in many multi-purpose codes like HERMES, CALOR
and also in the Geant3.21 code, where it was implemented via an
interface called GCALOR. HETC has been benchmarked against numerous
accelerator-based and space-based experiments with excellent success.
It describes energy resolutions in calorimeters with quite good
precision, and in Geant3.21, it was the prime candidate for radiation
studies when combined to the MICAP (the Monte Carlo Ionization Chamber
Analysis Program) transport code~\cite{wellisch}.
%which is used to simulate neutrons of low energy ($<20$~MeV)
HETC has also been adopted by a number of other organizations than
CERN, although it has often been tailored to their specific
requirements.


\subsection{Characteristics of HETC98}
%\subsection{Summary of  model features}
The version of HETC used in our Geant4
implementation work is HETC98 from year 1998 as used in BaBar
experiment. 
It's characteristics are enumerated in Table~\ref{taul:hetcCharacteristics}.

% \begin{table}[hbt]
% \caption{Evolution of the HETC code. Different versions and the
% related restrictions. ~\cite{hetc,alsmiller90}} \label{taul:hetcHistory} 
% \centering
% \begin{tabular}{|l|l|}
% %\hline
% %\multicolumn{2}{|c|}{HETC (High Energy Transport Code} \\
% \hline
% Version                 &       Restrictions or improvements\\
% \hline
% NTC (early 1960's)      &       $E_0 <\  \sim400$~MeV \\
% NMTC (1971)     &       $E_0 <\  \sim3$~GeV \\
% HETC/RSIC version (1972)        & $E_0$ above 3~GeV, incorporates \\
%                         &       MECC-7 and EVAP IV \cite{armstrong72}\\
% HETC/ORNL version       &       Nuclear data updated, \\
%                         &       multiple scattering updated \\
% HETC/Science Applications Inc.  &       Time dependence added,\\        
% version                 &       transport extended to ion beams \\
%                         &       of deuterons to alpha particles \\
% HETC88 (1988)           &       Multi-chain fragmentation model added\\
%                         &       for $E<5~{\rm GeV}$ \\
% \hline
% \end{tabular} 
% \end{table}

\begin{table}[!hbt]
\caption{Overview of Characteristics of HETC Code.}

\label{taul:hetcCharacteristics} %\cite???
\centering
\begin{tabular}{|l|l|}
%\hline
%\multicolumn{2}{|c|}{Characteristics of HETC} \\
\hline
Particles transported   &       Neutrons ($\geq15~\rm MeV$), protons, $\pi^\pm$, $\mu^\pm$ \\
%Particle energies allowed& At least $200~\rm TeV$ for protons~\cite{alsmiller90}        \\
Particle energies allowed& Up to $20~\rm TeV$ for incident nucleons and pions~\cite{alsmiller90}        \\
Mechanisms included     &       - Ionization and excitation \\
                        &       - Multiple coulomb scattering \\
                        &       - Range straggling, \\
                        &       - $\pi^\pm$ and $\mu^\pm$ decay \\
                        &       - Nuclear interactions \\
Calculational method    &       Monte Carlo\\
Nuclear collision model &       - Intranuclear-cascade-evaporation ($E<3$~GeV)\\
                        &       - Sternheimer-Lingenfelter isobar model for $\pi$ production ($E < 3~GeV$) \\
                        &       - Scaling model ($E > 3~GeV$) \\
                        &         (Phenomenological fits \\
                        &          to experimental data) \\
%Geometry                &       Three dimensional \\
Materials allowed       &       Arbitrary\\
Restrictions            &       $\pi^0$, $\gamma$ and heavy particles (d, t,:::HET, :::HEF \\
                        &        and residual nuclei products) \\
                        &       computed but not transported\\
Examples of applications&       - Accelerator and spacecraft shielding,\\
                        &       - Neutron cosmic ray background in Earth's \\
                        &       atmosphere \\
			&       - Doses for biological cell survival,\\
                        &       - Transmutation of\\
                        &       nuclear waste materials~\cite{hetc}\\
Principal shortages     &       Low-energy neutron transport ($E<15$~MeV) \\
                        &       electrons and $\gamma$'s\\
\hline
\end{tabular} 
\end{table}
%                        &       - Scaling model ($3~{\rm GeV} < E < 5~{\rm GeV}$)\\
%                        &       Multi-chain fragmentation ($E>5$~GeV)\\

%\begin{itemize}
%\item history, different versions
%\end{itemize}


%\begin{minipage}{\textwidth}
Particle transport and generation is handled in HETC98 with three different approaches:
 The code takes into account the dacay of charged pions and muons, 
nonelastic nucleon- and charged-pion-nucleus collisions.
Negative-pion capture at rest is treated via the INC evaporation model.

\begin{enumerate}
\item For energies less than $3~{\rm GeV}$, particles are generated by means
    of an intermediate-energy intranuclear cascade and evaporation models. 
The maximum allowable source-particle energies is not well defined.
The lower limit for the model is 20~MeV.
\item From $3~{\rm GeV}$ to approximately $10~{\rm GeV}$, 
particle generation is done by means of a scaling model, 
which combines the two different models.
%\nopagebreak[4]
\item Above $10~{\rm GeV}$, particle generation is done by means of a
    multi-chain fragmentation model.% (see chapter~\ref{chap:simuHadrCascs}).
\end{enumerate}
%\end{minipage}

% Before the implementation of the multi-fragmentation model in HETC88,
% the first approach of an INC and evaporation models was used with an
% extrapolation model for energies greater than 3~GeV. The extrapolation
% model, however, only extrapolated the results from the INC-evaporation
% model at 3~GeV enegies, and gave poor results.

In our implementation, only the approach 1 is implemented.
%the approaches 2 and 3 are not implemented.
%The multi-fragmentation model has its origin in the transport code
%FLUKA87, and, for copyright reasons, it cannot be used in Geant4.
%is not available for Geant4 hadronic models.


The functionality of HETC code in the lowest energy region can easily be
divided into three different parts, which are: the intranuclear
cascade (INC), which treats the interaction of high energy particles
with a nucleon; the de-excitation of the resulting nucleus by
evaporation of nucleons (in contrast to fission); and the transport of
primary and secondary particles in a thick target. In our work, also a
pre-equilibrium model, which usually is not part of the HETC, is
included in the model, whereas the transport part is left out, 
since it is handled by Geant4.

%\begin{itemize}
%\item three different models for different regimes
%\end{itemize}

% In the Geant4 implementation of HETC, there are three different parts
% that are use sequantially. First, the intranuclear cascade model is
% used. Then, a pre-equilibrium model is used to simulatee the
% transition to a thermodynamic equilibrium. It is followed by the
% evaporation and de-excitation algorithms, which handle the
% de-excitation of the nucleus by via emission f light nuclei and gamma
% particles.

\subsection{Intranuclear cascade (INC) model}

In HETC, different nuclear variables are calculated from models.  Only
%$N$-$N$ 
nucleon-nucleon cross-sections are taken as external variables. 
In the following we review the characteristics of the nuclera model in HETC.
The main variables are listed int Table :::


Short sketch of the model:

\begin{itemize}
\item If an interaction is supposed to happen, the impact point onto thenucleus is calculated
\item the nucleus is split into three different regions with different potentials, nucleon densities and Fermi energies.

\item nucleon-projectile interction is chosen according to partial cross-sections
\item the products of the interaction are tracked trough the regions  until the energy drops below a cut-off energy.
\end{itemize}

\subsection{Cross-sections}
Probabllility for interactions during INC is obtained using free (N, N) cross-sections. 
Cross-sections for production of one or two $\pi$ are included. 

Interaction ($\pi$, $N$) is equally
\subsection{Nuclear model}
We present here the nuclear model used in HETC.

\subsubsection{Nucleon dencity in the atom}

Continuous charge dencity
\begin{equation}
\rho(r) = \frac{\rho_1}{e^{\frac{r-c}{a}}+1}
\end{equation}

where $a= 0.545~fm$ and $cA^{1/3} = 1.07~fm$. $A$ is mass number and $\rho_1$ mormalization parameter.

In the code the nucleus is composed of three consentric spheres, 
corresponding $0.9$, $0.2$, and $0.01$ of the maximal dencity.
In every reqion the dencity is uniform, 
and defined as mean value of continuos charge distribution.
Normalization is set so that when integrating over the reqions, correct number of nucleons is achieved.
 
\subsubsection{Impulse distribution}
Impulse distribution in each region follows Fermi fermi distribution with zero temperature.

\begin{equation}
f(p) = c p ^2
\end{equation}

where

\begin{equation}
\int_0^{P_f} f(p) dp = n_p or n_n
\end{equation}

where $n_p$ and $n_n$ are the number of protons or neutrons in region.
$P_f$ is impulse corresponding the Fermi energy


\begin{equation}
E_f = \frac{P_f^2}{2m} = \frac{\hbar^2}{2m}(\frac{3\pi^2n}{v})^\frac{2}{3}
\end{equation}
 
which depend on the dencity $n/v$ of particles, 
and which is different for each particle and each region. 
The total distribution as on composite does not follow Fermi distribution with zero temperature.

\subsubsection{Distribution of potential energy}
The binding energy is systematically set to be $7~MeV$. 
In each region protons and neutrons have different potential energy.  
\subsubsection{Pauli exclusion principle}

Constrains imposed by the Pauli exclusion principle 
are taken into account 
by comparing energies of secondary particles.
If among socondary particles 
there is a nucleon with the energy lower than the Fermi energy 
$E < E_F$, then this interaction is consideres prohibited,
and the trajectori of the particle is traced further from the forbideden point.


Energies of particles are compared with the so-called cut-off energy $E_{cutoff}$.
Particles with the energy $E > E_{cutoff}$ participate in the development of the INC.
Typical values are listed in Table~\ref{table:cutoff}.


\begin{table}[!hbt]
\caption{Typical cut-off values for HETC particles.}

\hspace{0.5cm}

\label{table:cutoff} 
\centering
\begin{tabular}{lcll}
\hline
\em Particel   	& \em cut-off      	\\
\em Particel  	& \em enrgy [MeV]   	\\[2.5ex] 
\hline
$p$    		& $15$   		\\
$n$         	& $15$   		\\
$\mu$         	& $0.2$   		\\
$\pi^\pm$     	& $2$   		\\
\hline
\end{tabular} 
\end{table}


\subsubsection{Description of INC}

A key feature of this model is that, at sufficiently high energies,
the initial phase of reaction can be treated int terms of collisions
of the incident particle with individual nucleons inside the nucleus. 
The struck nucleons can cause further collisions, giving rise to a
particle ``cascede'' inside the nucleos; hence the term intranuclear
cascade describing this process.

\begin{figure}
  \begin{center}
    \leavevmode
    \rotatebox{0}{\mbox{\epsfxsize=8cm \epsfysize=6cm \epsffile{\PIC /mc.eps}}}
	\caption{Schematic diagram describing Monte Carlo simulation of INC. 400 MeV proton in colliding withnucleus, 
Here. for simplicity only one region is used. Crosses incicate Pauli-plocking}
  \label{sibtoo}
  \end{center}

\end{figure}


The implementation of the INC model is briefly described in the following steps:
\newcounter{list}
\begin{list}{\upshape \arabic{list}. }
        {\usecounter{list}
        \setlength{\labelwidth}{2cm}\setlength{\leftmargin}{2.6cm}
        \setlength{\labelsep}{0.5cm}\setlength{\rightmargin}{1cm}
        \setlength{\parsep}{0.5ex plus0.2ex minus0.1ex}
        \setlength{\itemsep}{0ex plus0.2ex}} %slshape
\item The spatial point where the incident particle enters the nucleus is determined by selecting it uniformly from the circle presenting the area of the nucleus projected on a plane.
\item A path length for the distance the particle travels before
        collision is selected by using the total particle-particle
        cross-sections and region-dependent nucleon densities.% (three
%        different regions).
\item If the particle escapes the nucleus without a collision, it will
        no longer be tracked in the INC model. Otherwise, the momentum
        of the struck nucleon, the type of reaction and the energy and
        direction of the reaction products are determined.
\item If the collision is not forbidden by the Pauli exclusion principle and
        if the kinetic energy of the product is above a predefined
        cutoff energy, the algorithm goes to step 2 to transport all
        the products further in the nucleus.
\item When the cascade is completed, the mass $A'$ and charge $Z'$ of
        the residual nucleus are determined from their conservation
        laws. Also the residual excitation energy $E^*$ is determined
        from the energy conservation law.
\end{list}             
%\end{minipage}


After the INC has been accomplished, $A'$, $Z'$ and $E^*$ are
used as input for the pre-equilibrium and the subsequent evaporation
algorithms to determine the number, type and energy of nucleons and
heavier particles ($d$, $t$, :::HET and $\alpha$ particles)
emitted. The remaining excitation energy is assumed to dissipate by
photon emission. 
%The $A$ and $Z$ of the final nucleus are then determined.
\subsubsection{Scaling model}
The information (particle types, energies, direction cosines, etc.)
obtained from the INC can be given as input to scaling routines, 
that use an extrapolation model to obtain the description of the collision products 
corresponding to the actual energy or the particle.
\subsection{Pre-equilibrium model}
\subsubsection{Separtion between INC and evaporation}


The outline of the pre-equilibrium model is as follows~\cite{ferrari96}:
\begin{list}{\upshape \arabic{list}. }
        {\usecounter{list}
        \setlength{\labelwidth}{2cm}\setlength{\leftmargin}{2.6cm}
        \setlength{\labelsep}{0.5cm}\setlength{\rightmargin}{1cm}
        \setlength{\parsep}{0.5ex plus0.2ex minus0.1ex}
        \setlength{\itemsep}{0ex plus0.2ex}} %slshape
    \item For a given excitation energy $E$, atomic number $A$ and
      number of excitons $n$ the equilibrium number of excitons
      $n_{eq}=\sqrt{0.5 + 2 g E}$ is calculated ($g$ is the single
      particle level density). Now if the current exciton number
      $n\geq n_{eq}$ or the excitation energy is below a predefined
      level (i.e. 50~MeV), then the pre-equilibrium algorithm is
      finished and further emission of fragments is done with an
      equilibrium model (here the evaporation model). If $n<n_{eq}$,
      the next step is performed.
\item   The transition probabilities and emission probabilities for $n$, $p$, 
        $d$, $t$, :::HET and :::HEF are calculated for
        the current nucleus. The probabilities are normalized, and one
        subprocess (emission or transition) is selected.
\item   In case of a transition the number of excitons is updated, if
        necessary, and the algorithm returns to step~1. Otherwise 
        the next step is performed.
\item   The kinetic energy of the fragment is selected.
\item   Momentum direction angles of the fragment are sampled from an
        isotropic distribution in the exciton system rest frame. The
        momentum is then boosted to the nucleus rest frame.
\item   Characteristics of the residual nucleus ($A$, $Z$, $E$ and 
        momentum $P$) are updated. The algorithm returns to step~1.
\end{list}             
%\end{minipage}

In HETC pre-equilibrium code have been used to replace the INC in in energy range $E < 200~MeV$.

\subsubsection{Model for Hydrogen nonelastic collision}

Nonelastic collisions with hydrogen nuclei are treated using experimental data 
and calculational nethod of Gabriel, Santoro and Barish.

\subsubsection{Implementation of CEM95 into Geant4.}
CEM95 is

The code CEM95 is intended for  the Monte Carlo calculation of nuclear
reactions in the framework of the Cascade-Exciton Model (CEM) of
nuclear reactions. The CEM assumes that reactions occur in three
stages. The first stage is the intranuclear cascade. The excited
residual nucleus formed after the  emission of cascade particles
determines the particle-hole configuration that is a starting point
for the second preequilibrium stage of the reaction. The subsequent
relaxation of the nuclear excitation is treated in terms of the
exciton model of preequilibrium decay which includes the description
of the equilibrium evaporative stage of the reaction.


 The CEM95 code is intended for calculation of reaction, elastic,
 fission and total cross sections;  excitation functions; nuclide
 yields, energy and angular spectra; double differential cross
 sections; mean multiplicities, i.e., number of ejectiles per incident
 bombarding particle; ejectile yields; mean energies and production
 cross sections for neutrons, protons, deuterons, tritons, He3, He4,
 pions-, pions0, and pions+ emitted in nucleon- and pion-induced
 reactions using the Cascade-Exciton Model (CEM) of Nuclear
 Reactions. A detailed description of the CEM may be found in
 Ref.1. Part of primary version of the code concerning the
 preequilibrium and equilibrium stages of reactions is published in
 Ref.2. The Dubna version of the  intranuclear cascade model used in
 the CEM95 is described in detail  in the monograph 3. A detailed
 description of the subroutines used at the cascade stage of reaction
 may be found in Ref.4. All the models incorporated in the CEM95 for
 description of the level density parameter are given in Ref.5. All
 the models incorporated in the CEM95 to take into account competition
 between particle emission and fission at the compound stage of the
 reactions are described in  Ref.6. Exemplary results obtained with
 the code CEM95 may be found in Refs.7,8.

9.
STATUS
IAEA1247/01: 21-APR-1995 tested at NEADB
1015.

NAME AND ESTABLISHMENT OF AUTHORS -.

  Dr. Mashnik Stepan
  Laboratory of Theoretical Physics
  Joint Institute for Nuclear Research
  141980 DUBNA
  Moscow Region
  RUSSIAN FEDERATION

A.  Cross Section and Resonance Integral Calculations                              
Computation of reaction  cross sections  from nuclear theory such  as        the  optical  or  Hauser Feshbach models,  resonance cross  sections  by        Breit Wigner or  multilevel theory, determination of differential  cross sections, cross section evaluation, and compilation programs.
Keywords: evaporation model, high-energy reactions, nuclear cascades,
nuclear models. \cite{gudima83}, \cite{mashnik94} 

\begin{itemize}

\item 
%\item CEM95 http://www.nea.fr/abs/html/iaea1247.html, http://www.nea.fr/abs/html/iaea1247.html}

\end{itemize}


\subsection{Evaporation model}

After the pre-equilibrium model, the nucleus is assumed to be in an
excited state, but in an internal thermal equilibrium.  The excitation
leads to emission of nucleons, light nuclei and $\gamma$ particles,
which are handled with the evaporation and de-excitation algorithms
\cite{iljinov92}.

%described in {\bf Chapter}. 

The evaporation algorithm %described in Fig.~\ref{fig:hetcVuokaavio} 
%is quite straight-forward. It 
consists of subsequent evaporation cycles, which are repeated until no
further evaporation is energetically possible.
%as long as the nucleus remains excited. 
On
each evaporation cycle, one particle ($n$, $p$, $d$, $t$, :::HET or
:::HEF) is sampled and emitted. The emission probabilities are obtained
according to the statistical evaporation theory of
Weisskopf~\cite{weisskopf37},where the probability to emit a
particle $i$ with kinetic energy between $\epsilon$ and $d\epsilon$
from a compound nucleus excited to an energy $E^*$ (measured from the
ground state) is
\begin{equation}\label{eq:weisskopf}
        P_i(\epsilon)d\epsilon = \frac{(2S_i+1)m_i}{\pi^2 \hbar^3} \sigma_{inv,i}(\epsilon)
        \frac{\rho_f(E^*- Q_i - \epsilon)}{\rho_i(E^*)}\epsilon d\epsilon,
\end{equation}
where $\rho$'s are the nuclear level densities for final and the
initial nuclei, $\sigma_{inv,i}$ is the cross-section for the inverse
reaction (total cross-section for capture of particle $i$ of energy
$\epsilon$ by the residual nucleus), $S_i$ and $m_i$ are spin and mass
of the emitted particle and $Q$ is its separation energy. This formula
also describes the kinetic energy distribution of the emitted particle.  The
state of the residual nucleus is updated when another cycle begins.
When no further particle emission is possible, the (still excited)
residual nucleus is given to the de-excitation algorithm. It is also
possible that there is no residual nucleus, as in the splitting of
:::BEE.

In the de-excitation algorithm, the remaining excitation energy of the
residual nucleus is used to emit photons, which are uniformly
distributed in the CMS frame. Their kinetic energy is sampled from a
uniform distribution between zero and the residual excitation energy.
Photons from this energy distribution are emitted as long as the
remaining excitation energy is positive; otherwise the kinetic energy
of the emitted photon is greater than the remaining excitation energy,
and in this case it is set to be equal to the remaining excitation
energy, which then goes to zero. This also ends the de-excitation
algorithm.



\subsection{De-exitation model}

%\begin{itemize}
%\item short description of INC, pre-equilibrium and evaporation \& de-excitation models
%\end{itemize}

\subsection{Implementing the HETC models into Geant4 } %:::make


\subsubsection{General architecture}

%\begin{figure} [h!tb] 
%\centering
%    \leavevmode
%     \epsfig{file=kuvat/kuva_HETCpackages.eps,width=0.8\textwidth}
%        \caption{UML diagram describing the architecture used in the implementation of HETC to Geant4.  \label{fig:hetcInGeant}}
%\end{figure}

Figure \ref{fig:hetcInGeant} describes general architecture used in
our HETC implementation. We divide project into three separate
architectural elements according to physics models: INC, pre-equilibrium and evaporation part.

The HETC implementation is treated as a discrete process and it is
inherited under {\it G4HadronInelasticProcess}.   

\subsubsection{Implementation of INC model}


\subsubsection{Implemetaion of pre-equilibrium model}


\subsubsection{Implementation of Evaporation and De-exitation Models}

%::: lleeter info follows 
%Tein koodista sellaista kuin HPW halusi.  Laitoin evaporation-hakemiston
%sisallon webbiin (BertiniEvapDx.tar.gz).  Sen doc-hakemisto on tosin viela
%kesken, sinne pitaisi laittaa ajan tasalla oleva UML-kuva ja varmaan se
%meidan raportti.  Se mun dippani on myos siella, koska vaikka sen UML-kuva
%onkin vanhentunut, niin siina on kuitenkin kuvaus teoriasta.
 
%Laitanpa tahan yhteenvedon koodiin tekemistani muutoksista, kun ne kerran
%viela tuoreessa muistissa ovat.
 
%Entinen paaluokka G4BertiniEvaporation.hh on nyt jaettu
%G4BertiniEvaporation- ja G4BertiniDeexcitation-luokkiin.  Ne on periytetty
%G4VEvaporation:sta ja G4VPhotonEvaporation:sta.  Niista on
%tarkoitus ulkopuolelta kayttaa seuraavia public-metodeja:
%---
%G4FragmentVector * BreakItUp( const
%G4Fragment & nucleus);  void setVerboseLevel( const G4int verbose );
%--- (eli siis samanlaiset metodit molemmissa)
 
%G4LayeredNucleusta en siis kayta enaa ollenkaan.
% 
%Evaporaatiokanavat ovat ennallaan (6 kpl), sen sijaan
%gamma-de-eksitaatio-kanavan nimi on muutettu (G4BEGammaDeexcitation ->
%G4BertiniDeexcitationChannel).
% 
%Muutin nuo muutamat testini yhteensopiviksi tuon uuden interfacen kanssa.
%Pikaisten kokeilujen jalkeen testit nayttavat antavan samoja tuloksia kuin
%siina raportissa ja dipassani on (en piirtanyt kuvaajia, mutta
%numeerisessa muodossa se oli ihan samankaltaista).
% 
%Muuten, jos meilla on utils-luokkia kaytossa, niin mun luokissa olevat
%isotropicCosines-metodit (arpovat isotrooppisesti jakautuneet kosinit)
%voisi laittaa utils-luokkiin.  Mutta toimiihan tuo nakojaan nytkin.
                                              
The implementation of the evaporation and de-excitation models in
Geant4 are described in Fig.~\ref{fig:bertiniUML}.  The interface to
the {\it G4Cascade} is done with the class {\it G4BertiniEvaporation}.
It has two methods, one for breaking up the nucleus and one for
setting the verbose level, with which Geant4 controls the amount of
details printed on the screen.  The method {\it BreakItUp} takes the
excited nucleus {\it G4LayeredNucleus} as its parameter.

As for the internal structure of the evaporation package, {\it
  G4BertiniEvaporation} is an aggregate of six evaporation channels
corresponding to each type of emission particle, and of one
de-excitation channel for photon emission.  Chargeless
neutrons have a distinct class for their evaporation
channel, whereas charged particles have a class for their common
properties ({\it G4BEChargedChannel}), from which the distinct
channels are inherited. On the whole, the size of the implementation
of evaporation and de-excitation models was about 1800 lines of code.
%from which 330 were in the header files.

The implementation was done in two phases.  In the first
implementation, the purpose was to reproduce the results of the HETC98
code by using the same algorithms and constants (i.e.\ particle
masses and algorithms to calculate the Q values) and thus ensure the
same functionality as in the HETC98 code. In the second phase, the
model was modified to use Geant4 constants and utility classes as well
as the kinetic energy sampling algorithm described
in~\cite{dostrovsky59}.  When compared to the simulation results of
the original (Fortran-based) HETC98 code, similar results were
expected with the first implementation, whereas some differences were
expected with the second implementation.


%\begin{figure} [h!tb] 
%\centering
%    \epsfig{file=kuvat/kuva_bertiniUML.eps,width=11cm}%12.6cm}
%   \caption{ UML Class diagram of the evaporation and de-excitation
%   models.  For the sake of clarity, the parameters and return
%   values have been left out.}
%    \label{fig:bertiniUML} 
%\end{figure}

% \begin{itemize}
% \item implementation \& class diagram
% \item differences due to use of G4 utility classes and different
%   energy sampling algorithm
% \end{itemize}

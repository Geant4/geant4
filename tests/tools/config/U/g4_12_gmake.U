?RCS:
?MAKE:g4make g4_gmake_version g4_gmake g4_make_version g4_make:\
	 g4debug Myread Getfile cat rm test
?MAKE:	-pick add $@ %<
?S:g4make:
?S:	This variable contains the value of the 'g4make' symbol, which
?S:	used for building G4SYSTEM.
?S:.
?INIT:#INITIALIZE G4MAKE
?INIT:g4make=""
?INIT:#END G4MAKE INITIALIZATION

#
# Configure which make to use...
# On WIN32, we have to watch for cygwin/Matlab clash
# Here, cygwin supplies make, Matlab 'gmake', but we must select
# cygwin make.
#
# Yes, we could use Loc's built in make, but want full control
# for now....
#

echo " "
echo "*CHECKS FOR CORRECT MAKE IMPLEMENTATION*"

g4_make_loc="no"
g4_gmake_loc="no"

g4_make_program=make
g4_gmake_program=gmake

g4_check_make_msg="Checking for $g4_make_program..."
g4_check_gmake_msg="Checking for $g4_gmake_program..."

g4_make_isgnu="no"
g4_gmake_isgnu="no"

g4_make_dirs=`echo $PATH | sed 's/\:/ /g'`

# Check for 'make' on all systems
g4_make_loc=`./loc $g4_make_program no $g4_make_dirs`
echo "$g4_check_make_msg $g4_make_loc"


# On anything but Windows, check for gmake as well
if test "x$g4osname" != "xWIN32" ; then
    g4_gmake_loc=`./loc $g4_gmake_program no $g4_make_dirs`
    echo "$g4_check_gmake_msg $g4_gmake_loc"
fi
 

# Now see if make/gmake are GNU make.
if test "x$g4_make_loc" != "xno" ; then
    g4_make_version=`$g4_make_loc -v 2>/dev/null | sed s"/'//"`

    case $g4_make_version in
	GNU*)
	    g4_make_isgnu=yes
	    ;;
	*)
	    g4_make_isgnu=no
	    ;;
    esac
    echo "Checking if make is GNU make... $g4_make_isgnu"
fi

if test "x$g4osname" != "xWIN32" ; then
    if test "x$g4_gmake_loc" != "xno" ; then
	g4_gmake_version=`$g4_gmake_loc -v 2>/dev/null | sed s"/'//"`

	case $g4_gmake_version in
	    GNU*)
		g4_gmake_isgnu=yes
	    	;;
	    *)
		g4_gmake_isgnu=no
		;;
	esac
	echo "Checking if gmake is GNU make... $g4_gmake_isgnu"
    fi
fi

# Now perform selection on following logic
# 1) If we have gmake AND it's GNU make, use that
# 2) If we have make AND it's GNU make, use that
# 3) If none of the above, prompt user for path to make program
if test "x$g4_gmake_loc" != "xno" -a "x$g4_gmake_isgnu" = "xyes" ; then
    g4make=$g4_gmake_loc
elif test "x$g4_make_loc" != "xno" -a "x$g4_make_isgnu" = "xyes" ; then
    g4make=$g4_make_loc
else
    g4_got_user_make="no"
    while test "x$g4_got_user_make" = "xno"; do
        g4message=`cat << EOM

    G4MAKE

A GNU make program could not be located on your system.
Please enter the full path to the GNU make program you
want to use:
EOM`
        dflt=$g4make
        rp=$g4message
        . ./myread
        gans=$ans

        #Check if this is GNU make...
        g4_user_make_version=`$gans -v 2>/dev/null | sed s"/'//"`

        case $g4_user_make_version in
	    "GNU Make"*)
		echo "Checking that $gans is GNU Make... yes"
	        g4make=$gans
                g4_got_user_make=yes
		;;
	    *)
	        echo "Checking that $gans is GNU Make... no"
		;;
	esac
    done
fi


